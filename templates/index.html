{% extends 'layout.html' %}

{% block body %}
<div class="container text-center">
    <h2>Real-Time License Plate Detection</h2>
    <br>

    <!-- Flux video -->
    <div>
        <img id="videoFeed" src="/video_feed" width="40%" style="border: 2px solid black; border-radius: 8px;">
    </div>
    <br>

    <!-- Butoane -->
    <div>
        <button id="toggleCamera" class="btn btn-primary" onclick="toggleCamera()">ğŸ¥ Start Camera</button>
    </div>
    <br>

    <!-- Imaginea decupatÄƒ a plÄƒcuÈ›ei -->
    <h3>PlÄƒcuÈ›Äƒ decupatÄƒ detectatÄƒ:</h3>
    <img id="croppedPlate" src="" style="display: none; max-width: 30%; margin-top: 10px; border: 2px solid red; border-radius: 8px;">
    
    <!-- Lista numerelor detectate -->
    <h3>Numere detectate:</h3>
    <ul id="capturedPlates"></ul>
</div>

<script>
    let cameraRunning = false;
    let videoFeed = document.getElementById("videoFeed");
    let toggleButton = document.getElementById("toggleCamera");
    let detectedPlatesList = document.getElementById("capturedPlates");
    let croppedPlateImg = document.getElementById("croppedPlate");

    function toggleCamera() {
        if (cameraRunning) {
            videoFeed.src = "";
            videoFeed.style.display = "none";
            toggleButton.innerText = "Start Camera";
        } else {
            videoFeed.src = "/video_feed";
            videoFeed.style.display = "block";
            toggleButton.innerText = "Stop Camera";
        }
        cameraRunning = !cameraRunning;
    }

    function startPlateUpdates() {
        setInterval(async () => {
            let response = await fetch("/get_detected_plates");
            let plates = await response.json();
            detectedPlatesList.innerHTML = "";  

            plates.forEach(plate => {
                let listItem = document.createElement("li");
                listItem.innerText = `${plate.number} - ${plate.status}`;
                detectedPlatesList.appendChild(listItem);
            });

            // ActualizeazÄƒ imaginea cu plÄƒcuÈ›a decupatÄƒ
            let croppedResponse = await fetch("/get_cropped_plate");
            if (croppedResponse.ok) {
                croppedPlateImg.src = "/get_cropped_plate";
                croppedPlateImg.style.display = "block";
            }

        }, 2000);
    }

    startPlateUpdates();
</script>
{% endblock %}
